{{ define "main" }}
<div class="homepage">
  <!-- Featured Article Section -->
  {{ $featured := where .Site.RegularPages "Params.featured" true }}
  {{ if $featured }}
    {{ with index $featured 0 }}
    <section class="featured-section">
      <h2 class="section-title">Featured</h2>
      <article class="featured-article">
        {{ if .Params.featured_image }}
          <div class="featured-image">
            <img src="{{ .Params.featured_image | relURL }}" alt="{{ .Title }}">
          </div>
        {{ end }}
        <h1>{{ .Title }}</h1>
        <div class="article-meta">
          <time datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "January 2, 2006" }}
          </time>
        </div>
        <p class="article-excerpt">{{ .Summary | plainify }}</p>
        <a href="{{ .RelPermalink }}" class="read-link">Read article →</a>
      </article>
    </section>
    {{ end }}
  {{ end }}

  <!-- Latest Content Section -->
  <section class="latest-section">
    <h2 class="section-title">Latest Content</h2>
    <div class="articles-list">
      {{ $posts := where (where .Site.RegularPages "Section" "posts") "Params.draft" false }}
      {{ range first 8 $posts }}
        <article class="article-item">
          {{ if .Params.featured_image }}
            <div class="article-image">
              <img src="{{ .Params.featured_image | relURL }}" alt="{{ .Title }}">
            </div>
          {{ end }}
          <div class="article-header">
            <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
            <time datetime="{{ .Date.Format "2006-01-02" }}" class="article-date">
              {{ .Date.Format "Jan 2, 2006" }}
            </time>
          </div>
          <p class="article-excerpt">{{ .Summary | plainify }}</p>
          <a href="{{ .RelPermalink }}" class="read-link">Read article →</a>
        </article>
      {{ end }}
    </div>
  </section>

  <!-- Recommended Reads Section -->
  {{ $allPosts := where (where .Site.RegularPages "Section" "posts") "Params.draft" false }}
  {{ $latestCount := 8 }}
  {{ $latestPosts := first $latestCount $allPosts }}
  
  <!-- Get posts beyond the latest for recommendations -->
  {{ $recommendationPool := after $latestCount (first 40 $allPosts) }}
  
  {{ if $recommendationPool }}
    <section class="recommended-section">
      <h2 class="section-title">Recommended Reads</h2>
      <div class="articles-list">
        <!-- Use a simple pseudo-random selection based on post index -->
        {{ range $index, $post := $recommendationPool }}
          {{ if or (eq (mod $index 2) 0) (eq (mod $index 3) 0) }}
            {{ if lt $index 6 }}
              <article class="article-item">
                {{ if $post.Params.featured_image }}
                  <div class="article-image">
                    <img src="{{ $post.Params.featured_image | relURL }}" alt="{{ $post.Title }}">
                  </div>
                {{ end }}
                <div class="article-header">
                  <h3><a href="{{ $post.RelPermalink }}">{{ $post.Title }}</a></h3>
                  <time datetime="{{ $post.Date.Format "2006-01-02" }}" class="article-date">
                    {{ $post.Date.Format "Jan 2, 2006" }}
                  </time>
                </div>
                <p class="article-excerpt">{{ $post.Summary | plainify }}</p>
                <a href="{{ $post.RelPermalink }}" class="read-link">Read article →</a>
              </article>
            {{ end }}
          {{ end }}
        {{ end }}
      </div>
    </section>
  {{ end }}
</div>
{{ end }}
